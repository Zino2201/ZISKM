# Using UZISKMInstancedSkeletalMeshComponent

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::tip
Before reading this, we recommend to check [Quick Start](/getting-started/quick-start) !
:::

## Introduction
[`UZISKMInstancedSkeletalMeshComponent`](/api-reference/ziskminstancedskeletalcomponent.mdx) allows you to use the full potential of the plugin. It is used like the `InstancedStaticMesh` component of Unreal, where you work with indices to reference instances. This component allows you to integrate the plugin easily with a custom ECS (e.g [entt](https://github.com/skypjack/entt/)) solution for large-scale games like RTS, City Builder or other genres.

## How to add an instance
[`AddInstance()`](/api-reference/ziskminstancedskeletalcomponent.mdx#addinstance) allows you to easily add an instance, returning its index for later use.

:::warning
Later on, you can try getting the underlying instance structure using [`GetInstance()`](/api-reference/ziskminstancedskeletalcomponent.mdx#getinstance), but keep in mind that you should **NEVER** store it as the reference is unstable!
:::

<Tabs groupId="lang" values={[
    {label: 'Blueprint', value: 'bp'},
    {label: 'C++', value: 'cpp'},
  ]}>
  <TabItem value="bp" default>

![Add Instance](/img/docs/advanced/1-addinstance.png)

  </TabItem>
  <TabItem groupId="lang" value="cpp">

```cpp
  int32 Index = Component->AddInstance(FTransform(FVector(500.f, 0.f, 0.f)));
```
  
  </TabItem>
</Tabs>

## Moving a instance
In order to move a instance, you can call [`UpdateTransform()`](/api-reference/ziskminstancedskeletalcomponent.mdx#updatetransform), this will add your instance to a list of instances that need transform updates. These updates are then uploaded to the GPU at the end of the frame before rendering.

## Custom Data
You can associate custom data using the `CustomData` property of [FZISKMInstance](/api-reference/ziskminstance.mdx). This can be used to store things like Velocity, indices or other to feed to other systems like your Anim Blueprint.

## Misc
### Culling
Culling is automatically managed by the component by default using the bounds of the Skeletal Mesh. 

### Animations
Animations are automatically managed by the component, by default it create one anim blueprint per instance.
:::warning
Your Anim Blueprint must derive from `UZISKMAnimInstance` to function properly!
:::
#### Accessing instance index & component
A `UZISKMAnimInstance`-derived AnimBP allows you to get the current instance index & component. You can then from there access data like transform or other.

![](/img/docs/advanced/2-animbp.png)

#### Ticking Rate & optimization
Anim Blueprints are only ticked when theirs associed instance are visible, additional optimization is also used to reduce ticking for instances faraway using LODs. Ensure that you have properly configured LODs in order for the plugin to function correctly.

